---
 sbin/tunefs/tunefs.c |   15 +++++++++++++++
 1 file changed, 15 insertions(+)

--- a/sbin/tunefs/tunefs.c
+++ b/sbin/tunefs/tunefs.c
@@ -48,8 +48,15 @@ __FBSDID("$FreeBSD$");
 #include <sys/mount.h>
 #include <sys/disklabel.h>
 #include <sys/stat.h>
+#ifndef HAVE_BSD_STATFS
+#include <sys/statvfs.h>
+#define statfs statvfs
+#define f_flags f_flag
+#endif
 
+#if HAVE_BSD_MOUNT
 #include <ufs/ufs/ufsmount.h>
+#endif
 #include <ufs/ufs/dinode.h>
 #include <ufs/ffs/fs.h>
 
@@ -84,8 +91,12 @@ main(int argc, char *argv[])
 	int mflag, mvalue, Nflag, nflag, oflag, ovalue, pflag, sflag, svalue;
 	int ch, found_arg, i;
 	const char *chg[2];
+#ifdef HAVE_BSD_MOUNT
 	struct ufs_args args;
+#endif
+#ifdef HAVE_BSD_STATFS
 	struct statfs stfs;
+#endif
 
 	if (argc < 3)
 		usage();
@@ -253,9 +264,11 @@ main(int argc, char *argv[])
 		goto err;
 	if (disk.d_name != special) {
 		special = disk.d_name;
+#ifdef HAVE_BSD_STATFS
 		if (statfs(special, &stfs) == 0 &&
 		    strcmp(special, stfs.f_mntonname) == 0)
 			active = 1;
+#endif
 	}
 
 	if (pflag) {
@@ -440,6 +453,7 @@ main(int argc, char *argv[])
 	if (sbwrite(&disk, Aflag) == -1)
 		goto err;
 	ufs_disk_close(&disk);
+#if HAVE_BSD_MOUNT && HAVE_BSD_STATFS
 	if (active) {
 		bzero(&args, sizeof(args));
 		if (mount("ufs", on,
@@ -447,6 +461,7 @@ main(int argc, char *argv[])
 			err(9, "%s: reload", special);
 		warnx("file system reloaded");
 	}
+#endif
 	exit(0);
 err:
 	if (disk.d_error != NULL)
